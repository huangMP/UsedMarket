<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.usedmarket.dao.DynamicsDao">

    <!--表名 -->
    <sql id="tableName">
        t_dynamics
    </sql>

    <!-- 字段 -->
    <sql id="Field">
        dynamics_id,
        type,
        title,
        text,
        origin,
        add_user,
        add_date,
        sort
    </sql>

    <!-- 字段值 -->
    <sql id="FieldValue">
        #{dynamicsId},
        #{type},
        #{title},
        #{text},
        #{origin},
        #{addUser},
        #{addDate},
        #{sort}
    </sql>

    <!-- 别名 -->
    <sql id="FieldAlias">
        t_dynamics.dynamics_id "dynamicsId",
        t_dynamics.type "type",
        t_dynamics.title "title",
        t_dynamics.text "text",
        t_dynamics.origin "origin",
        t_dynamics.add_user "addUser",
        t_dynamics.add_date "addDate",
        t_dynamics.sort "sort"
    </sql>

    <!-- 新增-->
    <insert id="insert" parameterType="Dynamics">
        insert into
        <include refid="tableName"></include>
        (
        <include refid="Field"></include>
        ) values (
        <include refid="FieldValue"></include>
        )
    </insert>

    <!-- 查找 -->
    <select id="findByDynamicsId" resultType="Dynamics">
        SELECT * FROM
        <include refid="tableName"></include>
        WHERE dynamics_id=#{dynamicsId}
    </select>


    <sql id="findDynamicsSql">
        SELECT
        <include refid="FieldAlias"/>,
        `t_user_info`.`username` `username`
        FROM `t_dynamics` INNER JOIN `t_user_info` ON `t_dynamics`.`add_user` = `t_user_info`.`user_id`
    </sql>

    <!-- 按要求查找 1.校园动态 2.捐赠动态-->
    <select id="findDynamicsByQueryCondition" resultType="DynamicsCustom" parameterType="QueryCondition">
        <include refid="findDynamicsSql"/>
        WHERE 1=1
        <if test="type != null and type != '' and type != 'all' ">
            AND `t_dynamics`.${type} = #{queryValue}
        </if>
        <if test="secondType != null and secondType != '' ">
            AND `t_dynamics`.${secondType} = #{secondQueryValue}
        </if>
        <if test="secondType != null and secondType != '' and secondType != 'all' ">
            AND `t_dynamics`.`title` like CONCAT(CONCAT('%', #{indistinctField}),'%')
        </if>
        <if test="orderBy != null and orderBy != '' ">
            ORDER BY ${orderBy} ${order}
        </if>
        LIMIT ${index},${size}
    </select>

    <!-- 更新 -->
    <update id="update" parameterType="Donation">
        UPDATE <include refid="tableName"></include>
        SET
        type=#{type},
        title=#{title},
        text=#{text},
        origin=#{origin},
        add_user=#{addUser},
        add_date=#{addDate},
        sort=#{sort}
        WHERE dynamics_id=#{dynamicsId}
    </update>

</mapper>
